name: Build libctags
run-name: "#${{ github.run_number }} ${{ github.event.head_commit.message }}. Run by ${{ github.actor }}"
on: [push, pull_request, workflow_dispatch]
env:
  VERSION_VAR: "3.2.1"

jobs:
  build:
    strategy:
      matrix:
        id: [x86, x64]
        include:
          - id: x86
            arch: Win32
          - id: x64
            arch: x64
    runs-on: windows-latest
    defaults:
      run:
        shell: cmd

    steps:
      - name: Checkout repo
        uses: actions/checkout@v4
#        with:
#          submodules: "recursive"

      - name: Matrix info
        run: |
          echo "id: ${{ matrix.id }}, arch: ${{ matrix.arch }}"

      - name: Make directories
        run: |
          set BUILD_DIR=${{ runner.temp }}
          echo "Build dir: %BUILD_DIR%"
          dir %BUILD_DIR%

      - name: Run batch script
        run: |
          set BUILD_DIR=${{ runner.temp }}
          .github\workflows\build.bat

      - name: Generate
        working-directory: ${{ runner.temp }}
        run: |
          cmake -G "Visual Studio 17 2022" -A ${{ matrix.arch }} ${{ github.workspace }}

      - name: Build
        working-directory: ${{ runner.temp }}
        run: |
          cmake --build . -v --config Release
